\section{Цели работы}

\begin{enumerate}
    \item Научиться создавать настольные приложения с графическим интерфейсом \guillemotleft Java FX\guillemotright~для платформы \guillemotleft Java\guillemotright~
    (далее --- \guillemotleft приложения\guillemotright) в интегрированной среде разработки (далее --- \guillemotleft IDE\guillemotright);
    \item Эксплуатировать IDE в режимах разработки и отладки;
    \item Собирать приложения для режима эксплуатации (запускать готовое приложение без IDE).
\end{enumerate}

\section{Ход работы}

Для достижения поставленных целей необходимо последовательно выполнить работы по следующему порядку:

\subsection{Создание проекта в IDE}

Для создания проекта в IDE \guillemotleft IntelliJ IDEA CE\guillemotright~необходимо в основном окне IDE нажать
на кнопку \guillemotleft New Project\guillemotright, как показано на изображении \ref{ris:00_01}.

\input{images/01}

В результате откроется диалог, показанный на изображении \ref{ris:00_02}, в котором необходимо установить параметры проекта:

\input{images/02}

\begin{itemize}
    \item Выбрать тип генератора проекта \guillemotleft JavaFX\guillemotright~(1);
    \item Создать префикс уникального именования Java-классов в модуле (рекомендуется стандартное именование изменить
    на именование на основе названия образовательной организации и фамилии обучающегося) (2);
    \item Задать имя для артефактов сборки (3) равное имени проекта (8);
    \item Выбрать JDK (4);
    \item Выбрать систему сборки \guillemotleft Maven\guillemotright~(5);
    \item Выбрать язык \guillemotleft Java\guillemotright~(6);
    \item Включить создание Git-репозитория (7);
    \item Задать имя проекта (8);
    \item Проверить размещение проекта (при необходимости переопределить) (9);
    \item Нажать кнопку \guillemotleft Next\guillemotright~(10).
\end{itemize}

\newpage
В результате будет открыт диалог следующего шага, показанный на изображении \ref{ris:00_03}.

\input{images/03}

Здесь не следует выбирать дополнительные библиотеки (1).
Для создания проекта необходимо нажать на кнопку \guillemotleft Create\guillemotright~(2).

\newpage
В результате созданный проект будет открыт в IDE, как показано на изображении \ref{ris:00_04}.

\input{images/04}

Сразу после открытия проекта IDE может указывать на неверно настроенный Java SDK (1), а в нижней части окна
может происходить процесс разрешения зависимостей проекта от дополнительных библиотек (2). Необходимо дождаться
завершения этого процесса, прежде чем что-либо делать с проектом далее.

\newpage
На изображении \ref{ris:00_05} показан один из файлов проекта (HelloApplication.java), название которого в IDE
подчёркнуто красным цветом. Так может происходить из-за некорректно настроенного Java SDK.

\input{images/05}

Чтобы настроить Java SDK для проекта необходимо нажать \guillemotleft Setup SDK\guillemotright~(1).


\newpage

В результате будет открыт диалог выбора Java SDK, показанный на изображении \ref{ris:00_06}.

\input{images/06}

Здесь можно выбрать необходимый Java SDK из списка определённых автоматически (1) или воспользоваться функцией
загрузки Java SDK (если в системе отсутствует Java SDK или IDE не смогла его определить).

\newpage
После корректной настройки Java SDK для проекта все визуальные уведомления IDE об ошибках в проекте исчезнут.
Проект, в котором IDE не сигнализирует об ошибках, показан на изображении \ref{ris:00_07}.
\input{images/07}

Файл проекта HelloApplication.java, название которого в IDE ранее было подчёркнуто красным цветом, теперь отображается
корректно (1), в коде отсутствуют выделения фрагментов текста красным цветом.

В данном случае файл HelloApplication.java содержит одноимённый класс HelloApplication (2), который, в свою очередь,
содержит метод main (3), с которого должно стартовать созданное приложение.

Для старта приложения из IDE достаточно нажать на кнопку в форме зелёного треугольника (4) на верхней панели.

В результате интегрированной средой разработки (IDE) будет предпринята попытка запустить приложение,
что не всегда может быть успешным.

\newpage

На изображении \ref{ris:00_08} показана неудачная попытка запуска приложения.
\input{images/08}

В выводе результатов сборки (1) сказано про несоответствие версии параметра source: в текущем проекте он имеет версию 8,
в то время как в тексте ошибки указывается на необходимость использовать версию 9 или выше.

Также IDE автоматически открыла файл (2), в котором выделены ошибочные (по \guillemotleft мнению\guillemotright~IDE)
фрагменты исходного кода (3).
Ошибочными они являются лишь с точки зрения использования указанной в проекте версии параметра source.

Следовательно, не нужно пытаться изменять \guillemotleft неправильный\guillemotright~по \guillemotleft мнению\guillemotright~IDE исходный код путём применения предложенных
интегрированной средой вариантов исправления. Необходимо помнить, что всё станет \guillemotleft правильно\guillemotright~, как только будут
решены проблемы совместимости версий в текущей конфигурации (которая была создана генератором проекта JavaFX).

Шаги по проверке проекта и решению описанных проблем последовательно описаны ниже.

\newpage
Для начала необходимо проверить параметры SDK и стандарта языка в структуре проекта. Для этого нужно открыть меню
\guillemotleft File\guillemotright~(1) и выбрать пункт \guillemotleft Project Structure\guillemotright~(2), как показано
на изображении \ref{ris:00_09}.

\input{images/09}

\newpage
В открывшемся диалоге, показанном на изображении \ref{ris:00_10}, необходимо проверить версию стандарта языка (1), затем
сохранить настройки (2).

\input{images/10}

\newpage
В структуре проекте, показанной на изображении \ref{ris:00_11}, необходимо открыть файл pom.xml (1), выполнив на нём
двойной клик левой клавишей мыши. В результате он будет отображён в списке файлов и открыт (2).

\input{images/11}

В этом файле необходимо изменить версию библиотеки \guillemotleft JavaFX\guillemotright~c 17.0.6 на 21.0.3 (3), затем
заменить значение у параметра source с 8 на 9 (4) (этот параметр вызывал ошибку при старте приложения, описанную выше),
после чего следует сохранить изменения в этом файле.

\newpage
На изображении \ref{ris:00_12} показано, что при изменении версии библиотеки \guillemotleft JavaFX\guillemotright~
новая версия будет подсвечена красным цветом (1). Так происходит по тому, что система сборки \guillemotleft Maven\guillemotright~
не располагает такой версией этой библиотеки в проекте, поскольку при работе генератора при создании проекта в IDE
была указана версия 17.0.6. Следовательно, система сборки \guillemotleft Maven\guillemotright~и подгрузила в качестве
зависимости эту версию библиотеки. Однако, версия 17.0.6 для наших целей не подходит и в файле pom.xml мы изменили номер версии.

\input{images/12}

Для обновления версии библиотеки посредством системы сборки \guillemotleft Maven\guillemotright~в таком случае будет доступна
специальная кнопка (2), нажатие на которую запустит процесс загрузки библиотеки той версии, которая указана в файле pom.xml.

\newpage
Процесс синхронизации и загрузки новых зависимостей (1) показан на изображении \ref{ris:00_13}.

\input{images/13}

\newpage
После завершения процесса синхронизации (1), как показано на изображении \ref{ris:00_14}, в файле pom.xml изменённая ранее версия
библиотеки перестанет быть подсвечена красным цветом (2), (3). Следовательно, сам файл pom.xml на этом этапе можно закрыть (4).

Теперь всё готово к первому запуску и для его осуществления необходимо открыть файл с главным классом приложения (5).

\input{images/14}

\newpage
\subsection{Запуск приложения в режиме разработки}

В режиме разработки из IDE приложение можно запустить путём нажатия на кнопку в виде зелёного треугольника в любом из трёх мест
интерфейса IDE (1) при открытом главном файле приложения, как показано на изображении \ref{ris:00_15}.

\input{images/15}

\newpage

Корректно запущенное графическое приложение (1) показано на изображении \ref{ris:00_16}.

\input{images/16}

Для завершения работы приложения можно закрыть его нажатием кнопки остановки (2) на панели IDE, или привычным для конечного
пользователя способом -- нажатием на кнопку закрытия приложения (3).

\newpage

После корректного завершения работы приложения в нижней части окна IDE будет показан код завершения (1), а панель запуска
IDE примет исходный вид, который был до запуска (2), как показано на изображении \ref{ris:00_17}.

\input{images/17}

Следует отметить, что такой способ запуска приложения приемлем только для целей разработки приложения в IDE непосредственно
в процессе программирования приложения.

Для конечного пользователя запуск приложения через IDE не предназначен. Сборка и запуск приложения для его эксплуатации
конечным пользователем будут рассмотрены ниже.

\newpage
\subsection{Запуск приложения в режиме отладки}

Для отладки приложения на панели IDE предусмотрена специальная кнопка в форме жука
(bug -- жук. debug -- анти-жук (устранение багов (bugs), т.е. отладка программы)).

В общем виде процесс запуска приложения в режиме отладки представлен на изображении \ref{ris:00_18}.

\input{images/18}

Чтобы запустить приложение в режиме отладки необходимо обозначить хотябы одну точку останова.

На изображении \ref{ris:00_18} показаны две точки останова: на строке 15 (1) и на строке 17 (2)
программного кода.

Запуск приложения в режиме отладки от обычного запуска отличается тем, что в случае запуска в режиме
отладки IDE остановится на каждой из выбранных точек останова и предоставит возможность пошагового
выполнения программы и просмотра состояния программного кода. Для запуска приложения в режим отладки
необходимо нажать на кнопку с изображением жука (3).

В результате приложение будет запущено и его выполнение будет остановлено на первой точке останова, как
показано на изображении \ref{ris:00_19}.

\input{images/19}

Панель запуска приложения в IDE изменит свой вид (1), строка кода на точке останова будет подсвечена (2),
откроется панель пошагового выполнения программы (3), будет доступна область просмотра состояния программного
кода на текущей точке останова (4).

Также можно заметить что IDE предоставляет дополнительную информацию поверх программного кода
-- серый текст с дополнительной информацией справа от строк программного кода.

Для дальнейшей отладки можно воспользоваться, например, кнопкой перехода на следующий шаг программы (5).

\newpage
\subsection{Сборка приложения для режима эксплуатации}

Под режимом эксплуатации подразумевается режим работы с приложением обычного пользователя (не программиста).

Другими словами -- это режим запуска для работы пользователя с уже готовым, разработанным и отлаженным приложением.

Для этого не требуется открывать проект с исходным кодом в IDE, собирать приложение и запускать его посредством
инструментария IDE.

Чтобы предоставить конечному пользователю готовое приложение необходимо его собрать и, при необходимости,
снабдить соответствующими инструкциями для его запуска.

Удобнее всего для такого случая собрать в одном месте всё необходимое для запуска и функционирования
приложения и написать сценарий запуска приложения.

В случае с приложением JavaFX для запуска готового к эксплуатации приложения в операционной системе
необходимо наличие следующих составляющих:

\begin{enumerate}
    \item jar-файл разработанного приложения (сейчас мы его соберём);
    \item Платформа Java (Java-runtime);
    \item Компоненты для работы JavaFX (JavaFX-runtime поставляется отдельно от Java-runtime);
    \item Сценарий запуска приложения, связывающий Java-runtime, JavaFX-runtime и jar-файл приложения
    (В этом разделе мы его создадим для ОС GNU/Linux в формате sh-сценария.
    Аналогичным образом можно создать sh-сценарий для ОС MacOSX или bat-сценарий для Windows).
\end{enumerate}

Чтобы упаковать разрабатываемое приложение в jar-файл для последующего запуска в среде выполнения Java
(её также называют Java-runtime) необходимо воспользоваться возможностями сборочной системы \guillemotleft Maven\guillemotright.

\newpage

Для работы с командами жизненного цикла сборочной системы \guillemotleft Maven\guillemotright~
в IDE существует специальная панель, которую можно вызвать нажатием на кнопку справа (1), как показано
на изображении \ref{ris:00_20}.

\input{images/20}

\newpage

В боковой панели \guillemotleft Maven\guillemotright~ необходимо раскрыть меню с названием приложения (1),
далее раскрыть меню  \guillemotleft Lifecycle\guillemotright~(2), затем в списке вариантов (3) выполнить
двойной клик левой клавишей мыши на пункт \guillemotleft package\guillemotright~(4),
как показано на изображении \ref{ris:00_21}.

\input{images/21}

\newpage

На изображении \ref{ris:00_22} показано окно IDE после запуска сборки пакета.

\input{images/22}

После запуска сборки (1) в нижней части IDE будет открыта панель с выводом команды сборки (2).

В дереве проекта будет создан каталог \guillemotleft target\guillemotright~(или обновлёно его содержимое,
если он был ранее создан), внутри которого после завершения процесса создания пакета
будет находиться результирующий jar-файл разработанного приложения (4).

На этом этапе важно понимать, что только этот файл важен с точки зрения эксплуатации приложения
конечным пользователем. Другими словами -- все остальные файлы и каталоги проекта не влияют на работу
созданного jar-файла (пакета программного обеспечения для запуска посредством Java-runtime и JavaFX-runtime).

Следовательно, для запуска этого пакета минимально необходимо и достаточно наличия в операционной системе Java-runtime, JavaFX-runtime
и файла со сценарием запуска приложения (по сути, сценарий запуска содержит одну команду запуска
jar-файла посредством комплексной платформы, состоящей из Java-runtime и JavaFX-runtime
с указанием на их место в операционной системе).

\newpage

Для создания файла сценария запуска необходимо выполнить клик правой клавишей мыши на корне дерева проекта (1),
Выбрать меню \guillemotleft New\guillemotright~(2), выбрать подменю \guillemotleft file\guillemotright~(3),
как показано на изображении \ref{ris:00_23}.

\input{images/23}

В диалоге \guillemotleft New File\guillemotright~, показанном на изображении \ref{ris:00_24},
необходимо ввести имя файла (обычно файл может называться run.sh или start.sh),
затем нажать на клавишу \guillemotleft Enter\guillemotright.

\input{images/24}

\newpage

В результате будет создан пустой файл (1), IDE предложит добавить файл для отслеживания изменений системой контроля версий
Git (2), файл будет доступен для редактирования (3), как показано на изображении \ref{ris:00_25}.

\input{images/25}

При необходимости, можно воспользоваться предложением IDE по установке дополнений для работы с файлами сценариев
bash (4).

В общем виде содержимое файла сценария запуска будет следующим:

\begin{verbatim}
#!/bin/sh
export PATH_TO_FX=~/.java/JavaFX SDK-23.0.1/lib
java \
--module-path $PATH_TO_FX \
--add-modules javafx.controls,javafx.fxml \
-cp target/fxapp-1.0-SNAPSHOT.jar \
nntc.ivanov.fxapp.HelloApplication

\end{verbatim}

\newpage

Для запуска полученного jar-файла необходимо наличие JavaFX SDK, поскольку переменная окружения

\begin{verbatim}
PATH_TO_FX
\end{verbatim}

, экспортируемая во 2 строке файла сценария, содержит путь до каталога lib внутри каталога JavaFX SDK-23.0.1,
а параметр

\begin{verbatim}
--module-path
\end{verbatim}

команды запуска посредством значения из этой переменной окружения связывает JavaFX-runtime с Java-runtime,
предоставляя при этом необходимый и достаточный функционал Java-платформы для запуска и функционирования
собранного в jar-файл приложения.

JavaFX SDK необходимо загрузить с официального сайта и распаковать в один из каталогов операционной системы.
Обычно этим каталогом является скрытый каталог .java в домашнем каталоге пользователя.

При необходимости, каталог с JavaFX SDK может быть размещён в одном каталоге с собранным jar-файлом. В таком случае
необходимо учитывать место нахождения этого каталога при формировании значения переменной окружения

\begin{verbatim}
PATH_TO_FX
\end{verbatim}

в сценарии запуска.

Также, при необходимости, каталог с Java SDK (Не путать с JavaFX SDK!) может быть размещён в одном каталоге
с собранным jar-файлом. В этом случае также необходимо учитывать место нахождения этого каталога
при формировании команды запуска приложения в файле сценария.

Пример структуры каталога, когда Java SDK и JavaFX SDK находятся в одном каталоге с jar-файлом:

\begin{verbatim}
release <-- каталог с приложением для эксплуатации
├── fxapp-1.0-SNAPSHOT.jar <-- jar-файл приложения
├── JavaFX SDK-23.0.1  <------ JavaFX SDK
├── openjdk-23.0.1  <--------- Java SDK
└── run.sh  <----------------- Сценарий запуска
\end{verbatim}

\newpage

Пример содержимого файла run.sh в таком случае:
\begin{verbatim}
#/bin/sh
export PATH_TO_FX=JavaFX SDK-23.0.1/lib
export JAVA_BIN=openjdk-23.0.1/bin/java

./$JAVA_BIN \
--module-path $PATH_TO_FX \
--add-modules javafx.controls,javafx.fxml \
-cp fxapp-1.0-SNAPSHOT.jar \
nntc.ivanov.fxapp.HelloApplication
\end{verbatim}

Подход, при котором в одном каталоге находятся jar-файл приложения, Java SDK, JavaFX SDK и файл запуска run.sh
позволяет создать полную сборку приложения, которую можно будет запустить на компьютере, на котором не
установлена платформа Java и отсутствуют какие-либо средства разработки.

По аналогии могут быть созданы каталоги для запуска одного и того же jar-файла в различных операционных системах,
работающих на различных аппаратных архитектурах. Разница будет лишь в сборках Java SDK, JavaFX SDK под
конкретную операционную систему, работающую на конкретной аппаратной архитектуре, а также в особенностях
создания сценария запуска под конкретную операционную систему.

\newpage
Порядок загрузки и распаковки JavaFX SDK показан далее, начиная с изображения \ref{ris:00_26}.

На главной странице официального сайта (1) страница загрузки JavaFX SDK (в которую встроен JavaFX-runtime) (2)
будет открыта после нажатия на кнопку загрузки (3).

\input{images/26}

\newpage

Далее на странице выбора для загрузки JavaFX SDK для операционной системы GNU/Linux под архитектуру x86\_64
необходимо установить набор фильтров (1), как показано на изображении \ref{ris:00_27}.

\input{images/27}

Далее в результирующей таблице (2) необходимо нажать на кнопку загрузки (3).

В результате начнётся процесс загрузки JavaFX SDK в формате набора файлов и каталогов в zip-архиве.

\newpage

Для распаковки содержимого загруженного zip-архива необходимо перейти в домашний каталог пользователя
и включить отображение скрытых файлов и каталогов нажатием сочетания клавиш Ctrl+H (1), как показано на
изображении \ref{ris:00_28}.

\input{images/28}

Из списка появившихся скрытых каталогов необходимо выбрать и перейти в каталог .java (1), как показано
на изображении \ref{ris:00_29}.

\input{images/29}

\newpage

Содержимое загруженного zip-архива (1) необходимо извлечь (2), воспользовавшись контекстным меню, вызываемым
нажатием правой клавиши мыши на файле, как показано на изображении \ref{ris:00_30}.

\input{images/30}

В результате рядом с файлом архива в каталоге (1) будет находиться его распакованное содержимое.
Необходимо перейти в этот каталог, как показано на изображении \ref{ris:00_31}.

\input{images/31}

\newpage

На изображении \ref{ris:00_32} слева показан каталог, находящийся внутри каталога, который получен в процессе распаковки
загруженного zip-архива. Справа показан каталог .java в домашнем каталоге пользователя.

Необходимо переместить каталог с распакованным JavaFX SDK в каталог .java в домашнем каталоге пользователя.

\input{images/32}

Чтобы проверить правильность распаковки каталога с JavaFX SDK (1) необходимо убедиться в наличии каталога lib (2)
внутри него, как показано на изображении \ref{ris:00_33}.

\input{images/33}

В общем виде путь до каталога с JavaFX-runtime внутри JavaFX SDK на этом этапе должен выглядеть так (3):

\begin{verbatim}
~/.java/javafx-sdk-a.b.c/lib
\end{verbatim}

При формировании значения переменной окружения

\begin{verbatim}
PATH_TO_FX
\end{verbatim}

важно точно указать путь до каталога lib внутри каталога JavaFX SDK, как это показано на изображении \ref{ris:00_34}.

\input{images/34}

\newpage
На изображении \ref{ris:00_35} показана интеграция IDE с файлами сценариев в формате sh в виде кнопки в форме
зелёного треугольника (1), позволяющего запустить файл сценария прямо из IDE.

\input{images/35}

Этим функционалом удобно пользоваться в процессе отладки файла сценария.
Выполнения команды (1) и запущенное приложение (2) показаны на изображении \ref{ris:00_36}.

\input{images/36}

Однако стоит помнить, что основное назначение файла сценария run.sh не в том, чтобы запускать его из IDE
(это лишь дополнительное удобство IDE на этапе разработки приложения), а в том, чтобы дать возможность
конечному пользователю запустить приложение (без IDE).

Подготовка к запуску приложения и его запуск без участия IDE (из терминала GNU/Linux) показаны на изображении
\ref{ris:00_37}.

\input{images/37}

Для запуска приложения через файл сценария run.sh без участия IDE необходимо перейти в каталог с проектом (1),
Определить файл сценария (2), затем сделать его исполняемым (3).

Чтобы убедиться в том, что файл стал исполняемым, необходимо просмотреть каталог повторно и убедиться что у файла (4)
появились аттрибуты x (5).

После этого файл можно запустить командой из терминала (6).

Результатом запуска будет открывшееся окно приложения (7).

При необходимости, можно создать отдельный каталог с приложением, подготовленным для конечного пользователя
скопировав jar-файл приложения, каталоги с Java SDK и JavaFX SDK в отдельный каталог и перенеся туда сценарий запуска,
адаптировав предварительно команду запуска в сценарии запуска, скорректировав пути расположения SDK.